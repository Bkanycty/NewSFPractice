{% extends 'default.html' %}
{% block head %}
{% load static %}
    <link href="{% static 'css/group_css/manager.css' %}" rel="stylesheet"/>
{% endblock head %}
{% block title %}
Мой Силант {{ user }}
{% endblock title %}
{% block body %}
<main>
    <div class="user"><h1>{{ user }}</h1></div>
    <div class="user"><h2>Информация о комплектации и технических характеристиках техники</h2></div>

<div class="tabs">
    <button class="tabs-button link-row" type="button" onclick="{general_information()}"><h1>Общая инфо</h1></button>
    <button class="tabs-button link-row" type="button" onclick="{maintenances()}"><h1>ТО</h1></button>
    <button class="tabs-button link-row" type="button" onclick="{reclamations()}"><h1>Рекламации</h1></button>
</div>

<form class="search-form" method="get">
    {{ machines_filter.form }}
    <input type="submit" value="Найти">
</form>
{% if object_list %}
    <table id="general-info-tab" class="search-results">
        <button id="general-info-tab-btn" type="button" class="add-btn" onclick='window.location.href="{% url 'machine_create' %}";'><span class="add-btn-span">Добавить машину</span></button>
        <tr class="table-head">
            <th>Модель машины</th><th>Зав. № машины</th><th>Модель двигателя</th><th>Зав. № двигателя</th><th>Модель трансмиссии</th><th>Зав. № трансмиссии</th><th>Модель ведущего моста</th><th>Зав. № ведущего моста</th><th>Модель управляемого моста</th><th>Зав. № управляемого моста</th><th>Договор поставки №, дата</th><th>Дата отгрузки с завода</th><th>Грузополучатель</th><th>Адрес поставки</th><th>Комплектация</th><th>Сервисная компания</th>
        </tr>
            {% for machine in object_list %}
            <tr class="link-row" onclick='window.location.href="{% url "machine_detail" machine.id %}";'>
                <td>{{ machine.machine_model }}
                <td>{{ machine.machine_factory_number }}
                <td>{{ machine.engine_model }}
                <td>{{ machine.engine_factory_number }}
                <td>{{ machine.transmission_model }}
                <td>{{ machine.transmission_factory_number }}
                <td>{{ machine.drive_axle_model }}
                <td>{{ machine.drive_axle_factory_number }}
                <td>{{ machine.steering_axle_model }}
                <td>{{ machine.steering_axle_factory_number }}
                <td>{{ machine.supply_contract }}
                <td>{{ machine.shipping_date }}
                <td>{{ machine.end_user }}
                <td>{{ machine.delivery_address }}
                <td>{{ machine.complete_set }}
                <td>{{ machine.service_company.first_name }}
            </tr>
            {% endfor %}
    </table>
{% else %}
    <h2><p id="notfound" class="not-found">Машин не найдено</p></h2>
{% endif %}

<table id="maintenance-tab" class="search-results" hidden>
    <button hidden id="maintenance-tab-btn" type="button" class="add-btn" onclick='window.location.href="{% url 'maintenance_create' %}";'><span class="add-btn-span">Внести данные о ТО</span></button>
    </tr>
    <tr class="table-head">
        <th>Обслуживаемая машина</th><th>Вид ТО</th><th>Дата проведения ТО</th><th>Наработка, м/час</th><th>№ заказ-наряда</th><th>Дата заказ-наряда</th><th>Организация, проводившая ТО</th>
    </tr>
    {% for maintenance in maintenances %}
    <tr class="table-row link-row" onclick='window.location.href="{% url 'maintenance_detail' maintenance.id %}";'>
        <td>{{ maintenance.maintenance_machine }}</td>
        <td>{{ maintenance.maintenance_type }}</td>
        <td>{{ maintenance.maintenance_date }}</td>
        <td>{{ maintenance.running_time }}</td>
        <td>{{ maintenance.work_order_number }}</td>
        <td>{{ maintenance.work_order_date }}</td>
        <td>{{ maintenance.maintenance_service_company.first_name }}</td>
    </tr>
    {% endfor %}
    
</table>

<table id="reclamations-tab" class="search-results" hidden>
    <button hidden id="reclamations-tab-btn" type="button" class="add-btn" onclick='window.location.href="{% url 'reclamation_create' %}";'><span class="add-btn-span">Зарегистрировать рекламацию</span></button>
    <tr class="table-head">
        <th>Дата отказа</th><th>Наработка, м/час</th><th>Узел отказа</th><th>Описание отказа</th><th>Способ восстановления</th><th>Используемые запасные части</th><th>Дата восстановления</th>
    </tr>
    {% for reclamation in reclamations %}
    <tr class="table-row link-row" onclick='window.location.href="{% url 'reclamation_detail' reclamation.id %}";'>
        <td>{{ reclamation.breakdown_date }}</td>
        <td>{{ reclamation.running_time }}</td>
        <td>{{ reclamation.broken_node }}</td>
        <td>{{ reclamation.breakdown_description }}</td>
        <td>{{ reclamation.recovery_method }}</td>
        <td>{{ reclamation.spare_parts_used }}</td>
        <td>{{ reclamation.recovery_date }}</td>
    </tr>
    {% endfor %}
    
</table>

<script type="text/javascript">
    function general_information() {
        var generalTab = document.getElementById("general-info-tab");
        var generalBtn = document.getElementById('general-info-tab-btn');
        var maintenancesTab = document.getElementById("maintenance-tab");
        var maintenancesBtn = document.getElementById('maintenance-tab-btn');
        var reclamationsTab = document.getElementById("reclamations-tab");
        var reclamationsBtn = document.getElementById('reclamations-tab-btn');

        generalTab.hidden = false;
        generalBtn.hidden = false;
        maintenancesTab.hidden = true;
        maintenancesBtn.hidden = true;
        reclamationsTab.hidden = true;
        reclamationsBtn.hidden = true;
    };
</script>

<script type="text/javascript">
    function maintenances() {
        var generalTab = document.getElementById("general-info-tab");
        var generalBtn = document.getElementById('general-info-tab-btn');
        var maintenancesTab = document.getElementById("maintenance-tab");
        var maintenancesBtn = document.getElementById('maintenance-tab-btn');
        var reclamationsTab = document.getElementById("reclamations-tab");
        var reclamationsBtn = document.getElementById('reclamations-tab-btn');

        generalTab.hidden = true;
        generalBtn.hidden = true;
        maintenancesTab.hidden = false;
        maintenancesBtn.hidden = false;
        reclamationsTab.hidden = true;
        reclamationsBtn.hidden = true;
    };
</script>

<script type="text/javascript">
    function reclamations() {
        var generalTab = document.getElementById("general-info-tab");
        var generalBtn = document.getElementById('general-info-tab-btn');
        var maintenancesTab = document.getElementById("maintenance-tab");
        var maintenancesBtn = document.getElementById('maintenance-tab-btn');
        var reclamationsTab = document.getElementById("reclamations-tab");
        var reclamationsBtn = document.getElementById('reclamations-tab-btn');

        generalTab.hidden = true;
        generalBtn.hidden = true;
        maintenancesTab.hidden = true;
        maintenancesBtn.hidden = true;
        reclamationsTab.hidden = false;
        reclamationsBtn.hidden = false;
    };
</script>

</h3>
</main>
{% endblock body %}